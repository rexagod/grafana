"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7494],{"./public/app/plugins/datasource/graphite/module.ts":(e,a,t)=>{t.r(a),t.d(a,{plugin:()=>Ia});var n=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),s=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),i=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),o=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/util/pipe.js"),l=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),c=t("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),m=t("./packages/grafana-runtime/src/index.ts"),u=t("./packages/grafana-data/src/index.ts");function d(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const p=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/;class g{constructor(e){d(this,"major",void 0),d(this,"minor",void 0),d(this,"patch",void 0),d(this,"meta",void 0),this.major=0,this.minor=0,this.patch=0,this.meta="";const a=p.exec(e);a&&(this.major=Number(a[1]),this.minor=Number(a[2]||0),this.patch=Number(a[3]||0),this.meta=a[4])}isGtOrEq(e){const a=new g(e);for(let e=0;e<this.comparable.length;++e){if(this.comparable[e]>a.comparable[e])return!0;if(this.comparable[e]<a.comparable[e])return!1}return!0}isValid(){return(0,n.isNumber)(this.major)}get comparable(){return[this.major,this.minor,this.patch]}}function h(e,a){return new g(e).isGtOrEq(a)}function f(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const y={};function v(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],y[e.name]=e,e.shortName&&(y[e.shortName]=e)}const x=[{name:"other",type:"value_or_series",optional:!0,multiple:!0}];function b(e,a){return!e.version||h(a,e.version)}v({name:"scaleToSeconds",category:"Transform",params:[{name:"seconds",type:"int"}],defaultParams:[1]}),v({name:"perSecond",category:"Transform",params:[{name:"max value",type:"int",optional:!0}],defaultParams:[]}),v({name:"holtWintersForecast",category:"Calculate"}),v({name:"holtWintersConfidenceBands",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),v({name:"holtWintersAberration",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),v({name:"nPercentile",category:"Calculate",params:[{name:"Nth percentile",type:"int"}],defaultParams:[95]}),v({name:"diffSeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"stddevSeries",params:x,defaultParams:[""],category:"Combine"}),v({name:"divideSeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"multiplySeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"asPercent",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"group",params:x,defaultParams:["#A","#B"],category:"Combine"}),v({name:"sumSeries",shortName:"sum",category:"Combine",params:x,defaultParams:[""]}),v({name:"averageSeries",shortName:"avg",category:"Combine",params:x,defaultParams:[""]}),v({name:"rangeOfSeries",category:"Combine"}),v({name:"percentileOfSeries",category:"Combine",params:[{name:"n",type:"int"},{name:"interpolate",type:"boolean",options:["true","false"]}],defaultParams:[95,"false"]}),v({name:"sumSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),v({name:"maxSeries",shortName:"max",category:"Combine"}),v({name:"minSeries",shortName:"min",category:"Combine"}),v({name:"averageSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),v({name:"alias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:["alias"]}),v({name:"aliasSub",category:"Alias",params:[{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:["","\\1"]}),v({name:"consolidateBy",category:"Special",params:[{name:"function",type:"string",options:["sum","average","min","max"]}],defaultParams:["max"]}),v({name:"cumulative",category:"Special",params:[],defaultParams:[]}),v({name:"groupByNode",category:"Combine",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]},{name:"function",type:"string",options:["sum","avg","maxSeries"]}],defaultParams:[3,"sum"]}),v({name:"aliasByNode",category:"Alias",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[3]}),v({name:"substr",category:"Special",params:[{name:"start",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]},{name:"stop",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:[0,0]}),v({name:"sortByName",category:"Sorting",params:[{name:"natural",type:"boolean",options:["true","false"],optional:!0}],defaultParams:["false"]}),v({name:"sortByMaxima",category:"Sorting"}),v({name:"sortByMinima",category:"Sorting"}),v({name:"sortByTotal",category:"Sorting"}),v({name:"aliasByMetric",category:"Alias"}),v({name:"randomWalk",fake:!0,category:"Special",params:[{name:"name",type:"string"}],defaultParams:["randomWalk"]}),v({name:"countSeries",category:"Combine"}),v({name:"constantLine",category:"Special",params:[{name:"value",type:"int"}],defaultParams:[10]}),v({name:"cactiStyle",category:"Special"}),v({name:"keepLastValue",category:"Transform",params:[{name:"n",type:"int"}],defaultParams:[100]}),v({name:"changed",category:"Special",params:[],defaultParams:[]}),v({name:"scale",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[1]}),v({name:"offset",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[10]}),v({name:"transformNull",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[0]}),v({name:"integral",category:"Transform"}),v({name:"derivative",category:"Transform"}),v({name:"nonNegativeDerivative",category:"Transform",params:[{name:"max value or 0",type:"int",optional:!0}],defaultParams:[""]}),v({name:"timeShift",category:"Transform",params:[{name:"amount",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"]}),v({name:"timeStack",category:"Transform",params:[{name:"timeShiftUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]},{name:"timeShiftStart",type:"int"},{name:"timeShiftEnd",type:"int"}],defaultParams:["1d",0,7]}),v({name:"summarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]},{name:"alignToFrom",type:"boolean",optional:!0,options:["false","true"]}],defaultParams:["1h","sum","false"]}),v({name:"smartSummarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["1h","sum"]}),v({name:"absolute",category:"Transform"}),v({name:"hitcount",category:"Transform",params:[{name:"interval",type:"string"}],defaultParams:["10s"]}),v({name:"log",category:"Transform",params:[{name:"base",type:"int"}],defaultParams:["10"]}),v({name:"averageAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"averageBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"currentAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"currentBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"maximumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"maximumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"minimumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"minimumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"limit",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"mostDeviant",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[10]}),v({name:"exclude",category:"Filter Series",params:[{name:"exclude",type:"string"}],defaultParams:["exclude"]}),v({name:"highestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"highestMax",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"lowestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"movingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10]}),v({name:"movingMedian",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:["5"]}),v({name:"stdev",category:"Calculate",params:[{name:"n",type:"int"},{name:"tolerance",type:"int"}],defaultParams:[5,.1]}),v({name:"highestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"lowestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"removeAbovePercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeAboveValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeBelowPercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeBelowValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"useSeriesAbove",category:"Filter Series",params:[{name:"value",type:"int"},{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:[0,"search","replace"]}),v({name:"aggregateLine",category:"Calculate",params:[{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["avg"],version:"1.0"}),v({name:"averageOutsidePercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),v({name:"delay",category:"Transform",params:[{name:"steps",type:"int"}],defaultParams:[1],version:"1.0"}),v({name:"exponentialMovingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"fallbackSeries",category:"Special",params:[{name:"fallback",type:"string"}],defaultParams:["constantLine(0)"],version:"1.0"}),v({name:"grep",category:"Filter Series",params:[{name:"grep",type:"string"}],defaultParams:["grep"],version:"1.0"}),v({name:"groupByNodes",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:["sum",3],version:"1.0"}),v({name:"integralByInterval",category:"Transform",params:[{name:"intervalUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"],version:"1.0"}),v({name:"interpolate",category:"Transform",params:[{name:"limit",type:"int",optional:!0}],defaultParams:[],version:"1.0"}),v({name:"invert",category:"Transform",version:"1.0"}),v({name:"isNonNull",category:"Combine",version:"1.0"}),v({name:"linearRegression",category:"Calculate",params:[{name:"startSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0},{name:"endSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:[],version:"1.0"}),v({name:"mapSeries",shortName:"map",params:[{name:"node",type:"int"}],defaultParams:[3],category:"Combine",version:"1.0"}),v({name:"movingMin",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"movingMax",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"movingSum",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"multiplySeriesWithWildcards",category:"Combine",params:[{name:"position",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[2],version:"1.0"}),v({name:"offsetToZero",category:"Transform",version:"1.0"}),v({name:"pow",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[10],version:"1.0"}),v({name:"powSeries",category:"Transform",params:x,defaultParams:[""],version:"1.0"}),v({name:"reduceSeries",shortName:"reduce",params:[{name:"function",type:"string",options:["asPercent","diffSeries","divideSeries"]},{name:"reduceNode",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"reduceMatchers",type:"string",multiple:!0}],defaultParams:["asPercent",2,"used_bytes"],category:"Combine",version:"1.0"}),v({name:"removeBetweenPercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),v({name:"removeEmptySeries",category:"Filter Series",version:"1.0"}),v({name:"squareRoot",category:"Transform",version:"1.0"}),v({name:"timeSlice",category:"Transform",params:[{name:"startSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"]},{name:"endSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:["-1h"],version:"1.0"}),v({name:"weightedAverage",category:"Combine",params:[{name:"other",type:"value_or_series",optional:!0},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:["#A",4],version:"1.0"}),v({name:"seriesByTag",category:"Special",params:[{name:"tagExpression",type:"string",multiple:!0}],version:"1.1"}),v({name:"groupByTags",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"tag",type:"string",multiple:!0}],defaultParams:["sum","tag"],version:"1.1"}),v({name:"aliasByTags",category:"Alias",params:[{name:"tag",type:"string",multiple:!0}],defaultParams:["tag"],version:"1.1"});class j{constructor(e,a){f(this,"def",void 0),f(this,"params",void 0),f(this,"text",void 0),f(this,"hidden",void 0),this.def=e,this.params=[],a&&a.withDefaultParams&&e.defaultParams&&(this.params=e.defaultParams.slice(0)),this.updateText()}render(e,a){const t=this.def.name+"(",r=(0,n.map)(this.params,((e,t)=>{let r;if(t<this.def.params.length?r=this.def.params[t].type:(0,n.get)((0,n.last)(this.def.params),"multiple")&&(r=(0,n.get)((0,n.last)(this.def.params),"type")),(0,n.includes)(["value_or_series","boolean","int","float","node","int_or_infinity"],r))return e;const s=(0,n.isString)(e)?a(e):e;return(0,n.includes)(["int_or_interval","node_or_tag"],r)&&(0,n.isFinite)(+s)?(0,n.toString)(e):"'"+e+"'"}));for(;""===r[r.length-1];)r.pop();return e&&r.unshift(e),t+r.join(", ")+")"}_hasMultipleParamsInString(e,a){return-1!==e.indexOf(",")&&(!(!this.def.params[a+1]||!this.def.params[a+1].optional)||!!(a+1>=this.def.params.length&&(0,n.get)((0,n.last)(this.def.params),"multiple")))}updateParam(e,a){this._hasMultipleParamsInString(e,a)?(0,n.each)(e.split(","),((e,t)=>{this.updateParam(e.trim(),a+t)})):(""===e&&(a>=this.def.params.length||this.def.params[a].optional)?this.params.splice(a,1):this.params[a]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}}function w(e,a){return(a||y)[e]?(a||y)[e]:{name:e,params:[{name:"",type:"",multiple:!0}],defaultParams:[""],unknown:!0}}const S={createFuncInstance:function(e,a,t){return(0,n.isString)(e)&&(e=w(e,t)),new j(e,a)},getFuncDef:w,getFuncDefs:function(e,a){const t={};return(0,n.forEach)(a||y,(a=>{b(a,e)&&(t[a.name]=(0,n.assign)({},a,{params:(0,n.filter)(a.params,(a=>b(a,e)))}))})),t},parseFuncDefs:function(e){const a={};return(0,n.forEach)(e||{},((e,t)=>{if("Graph"===e.group)return;let r=e.description;r&&(r=r.replace(/:py:func:`(.+)( <[^>]*>)?`/g,"``$1``").replace(/.. seealso:: /g,"See also: ").replace(/.. code-block *:: *none/g,".. code-block::"));const s={name:e.name,description:r,category:e.group,params:[],defaultParams:[],fake:!1};/^seriesLists?$/.test((0,n.get)(e,"params[0].type",""))?e.params[0].multiple?e.params[0].required=!1:e.params.shift():s.fake=!0,(0,n.forEach)(e.params,(e=>{const a={name:e.name,type:"string",optional:!e.required,multiple:!!e.multiple,options:void 0};void 0!==e.default?e.default===1/0?s.defaultParams.push("inf"):s.defaultParams.push((0,n.toString)(e.default)):e.suggestions?s.defaultParams.push((0,n.toString)(e.suggestions[0])):s.defaultParams.push(""),"boolean"===e.type?(a.type="boolean",a.options=["true","false"]):"integer"===e.type?a.type="int":"float"===e.type?a.type="float":"node"===e.type?(a.type="node",a.options=["0","1","2","3","4","5","6","7","8","9","10","11","12"]):"nodeOrTag"===e.type?(a.type="node_or_tag",a.options=["name","0","1","2","3","4","5","6","7","8","9","10","11","12"]):"intOrInterval"===e.type?a.type="int_or_interval":"seriesList"===e.type?a.type="value_or_series":"intOrInf"===e.type&&(a.type="int_or_infinity"),e.options?a.options=(0,n.map)(e.options,n.toString):e.suggestions&&(a.options=(0,n.map)(e.suggestions,n.toString)),s.params.push(a)})),a[t]=s})),a}};var P=t("./public/app/features/templating/template_srv.ts");let C;function T(e){if(e)return parseInt(e,10)}function q(e){if(e)return"true"===e||"false"!==e&&parseInt(e,10)}function k(e){for(const t of e){const e=t["archive-read"];if(e>0){var a;return{text:`Data is rolled up, aggregated over ${D(t["schema-retentions"])[e].interval} using ${(null!==(a=t["consolidator-normfetch"])&&void 0!==a?a:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function M(e){for(const t of e){const e=t["aggnum-rc"];if(e>0){var a;return{text:`Data is runtime consolidated, ${e} datapoints combined using ${(null!==(a=t["consolidator-rc"])&&void 0!==a?a:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function D(e){return e?e.split(",").map((e=>{const a=e.split(":");return{interval:a[0],retention:a[1],chunkspan:a[2],numchunks:T(a[3]),ready:q(a[4])}})):[]}!function(e){e.Default="default",e.Metrictank="metrictank"}(C||(C={}));var F=t("./public/app/features/variables/utils.ts");const I=["0.9","1.0","1.1"],N=(0,n.last)(I);function _(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}class A extends u.DataSourceApi{constructor(e,a=(0,P.J)()){var t,r;super(e),_(this,"basicAuth",void 0),_(this,"url",void 0),_(this,"name",void 0),_(this,"graphiteVersion",void 0),_(this,"supportsTags",void 0),_(this,"isMetricTank",void 0),_(this,"rollupIndicatorEnabled",void 0),_(this,"cacheTimeout",void 0),_(this,"withCredentials",void 0),_(this,"funcDefs",null),_(this,"funcDefsPromise",null),_(this,"_seriesRefLetters",void 0),_(this,"metricMappings",void 0),_(this,"convertResponseToDataFrames",(e=>{const a=[];if(!e||!e.data)return{data:a};const t=e.data.series||e.data;if(!(0,n.isArray)(t))throw{message:"Missing series in result",data:e};for(let n=0;n<t.length;n++){const r=t[n];r.title=r.target;for(let e=0;e<r.datapoints.length;e++)r.datapoints[e][1]*=1e3;const s=(0,u.toDataFrame)(r);if(r.meta){if(s.meta={custom:{requestMetaList:e.data.meta,seriesMetaList:r.meta}},this.rollupIndicatorEnabled){const e=k(r.meta),a=M(r.meta);e?s.meta.notices=[e]:a&&(s.meta.notices=[a])}0===n&&e.data.meta.stats&&(s.meta.stats=this.getRequestStats(e.data.meta))}a.push(s)}return{data:a}})),this.templateSrv=a,this.templateSrv=a,this.basicAuth=e.basicAuth,this.url=e.url,this.name=e.name,this.graphiteVersion=e.jsonData.graphiteVersion||N,this.metricMappings=(null===(t=e.jsonData.importConfiguration)||void 0===t||null===(r=t.loki)||void 0===r?void 0:r.mappings)||[],this.isMetricTank=e.jsonData.graphiteType===C.Metrictank,this.supportsTags=h(this.graphiteVersion,"1.1"),this.cacheTimeout=e.cacheTimeout,this.rollupIndicatorEnabled=e.jsonData.rollupIndicatorEnabled,this.withCredentials=e.withCredentials,this.funcDefs=null,this.funcDefsPromise=null,this._seriesRefLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ"}getQueryOptionsInfo(){return{maxDataPoints:!0,cacheTimeout:!0,links:[{text:"Help",url:"http://docs.grafana.org/features/datasources/graphite/#using-graphite-in-grafana"}]}}getImportQueryConfiguration(){return{loki:{mappings:this.metricMappings}}}query(e){const a={from:this.translateTime(e.range.raw.from,!1,e.timezone),until:this.translateTime(e.range.raw.to,!0,e.timezone),targets:e.targets,format:e.format,cacheTimeout:e.cacheTimeout||this.cacheTimeout,maxDataPoints:e.maxDataPoints},t=this.buildGraphiteParams(a,e.scopedVars);if(0===t.length)return(0,r.of)({data:[]});this.isMetricTank&&t.push("meta=true");const n={method:"POST",url:"/render",data:t.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this.addTracingHeaders(n,e),e.panelId&&(n.requestId=this.name+".panelId."+e.panelId),this.doGraphiteRequest(n).pipe((0,l.U)(this.convertResponseToDataFrames))}addTracingHeaders(e,a){!this.url.match(/^http/)&&(a.dashboardId&&(e.headers["X-Dashboard-Id"]=a.dashboardId),a.panelId&&(e.headers["X-Panel-Id"]=a.panelId))}getRequestStats(e){const a=[];for(const t in e.stats){let n;t.endsWith(".ms")&&(n="ms"),a.push({displayName:t,value:e.stats[t],unit:n})}return a}parseTags(e){let a=[];return a=e.split(","),1===a.length&&(a=e.split(" "),""===a[0]&&(a=[])),a}interpolateVariablesInQueries(e,a){let t=e;return e&&e.length>0&&(t=e.map((e=>{var t;return Object.assign({},e,{datasource:this.getRef(),target:this.templateSrv.replace(null!==(t=e.target)&&void 0!==t?t:"",a)})}))),t}annotationQuery(e){if(e.annotation.target){const a=this.templateSrv.replace(e.annotation.target,{},"glob"),t={range:e.range,targets:[{target:a}],format:"json",maxDataPoints:100};return(0,s.n)(this.query(t).pipe((0,l.U)((a=>{const t=[];for(let n=0;n<a.data.length;n++){const r=a.data[n];for(let a=0;a<r.length;a++){const n=r.fields[0].values.get(a);r.fields[1].values.get(a)&&t.push({annotation:e.annotation,time:n,title:r.name})}}return t}))))}{const a=this.templateSrv.replace(e.annotation.tags);return this.events({range:e.range,tags:a}).then((a=>{const t=[];if(!(0,n.isArray)(a.data))return console.error(`Unable to get annotations from ${a.url}.`),[];for(let r=0;r<a.data.length;r++){const s=a.data[r];let i=s.tags;(0,n.isString)(s.tags)&&(i=this.parseTags(s.tags)),t.push({annotation:e.annotation,time:1e3*s.when,title:s.what,tags:i,text:s.data})}return t}))}}events(e){try{let a="";return e.tags&&(a="&tags="+e.tags),(0,s.n)(this.doGraphiteRequest({method:"GET",url:"/events/get_data?from="+this.translateTime(e.range.raw.from,!1,e.timezone)+"&until="+this.translateTime(e.range.raw.to,!0,e.timezone)+a}))}catch(e){return Promise.reject(e)}}targetContainsTemplate(e){var a;return this.templateSrv.variableExists(null!==(a=e.target)&&void 0!==a?a:"")}translateTime(e,a,t){if((0,n.isString)(e)){if("now"===e)return"now";if(e.indexOf("now-")>=0&&-1===e.indexOf("/"))return e=(e=(e=e.substring(3)).replace("m","min")).replace("M","mon");e=u.dateMath.parse(e,a,t)}return a?e.get("s")&&e.add(1,"s"):!1===a&&e.get("s")&&e.subtract(1,"s"),e.unix()}metricFindQuery(e,a){const t=a||{};let n=this.templateSrv.replace(e,(0,F._6)({query:e,wildcardChar:"",options:a})),r=n.match(/^tag_values\((.*)\)$/),s=r?r[1].split(",").filter((e=>!!e)):void 0;if(s)return t.limit=1e4,this.getTagValuesAutoComplete(s.slice(1),s[0],void 0,t);if(r=n.match(/^tags\((.*)\)$/),s=r?r[1].split(",").filter((e=>!!e)):void 0,s)return t.limit=1e4,this.getTagsAutoComplete(s,void 0,t);let i,o=e.match(/^expand\((.*)\)$/);return e=o?o[1]:e,n=this.templateSrv.replace(e,(0,F._6)({query:e,wildcardChar:"*",options:a})),t.range&&(i={from:this.translateTime(t.range.from,!1,t.timezone),until:this.translateTime(t.range.to,!0,t.timezone)}),o?this.requestMetricExpand(n,t.requestId,i):this.requestMetricFind(n,t.requestId,i)}requestMetricFind(e,a,t){const r={method:"POST",url:"/metrics/find",params:{},data:`query=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:a};return t&&(r.params.from=t.from,r.params.until=t.until),(0,s.n)(this.doGraphiteRequest(r).pipe((0,l.U)((e=>(0,n.map)(e.data,(e=>({text:e.text,expandable:!!e.expandable})))))))}requestMetricExpand(e,a,t){const r={method:"GET",url:"/metrics/expand",params:{query:e},headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:a};return t&&(r.params.from=t.from,r.params.until=t.until),(0,s.n)(this.doGraphiteRequest(r).pipe((0,l.U)((e=>(0,n.map)(e.data.results,(e=>({text:e,expandable:!1})))))))}getTags(e){const a=e||{},t={method:"GET",url:"/tags",requestId:a.requestId};return a.range&&(t.params.from=this.translateTime(a.range.from,!1,a.timezone),t.params.until=this.translateTime(a.range.to,!0,a.timezone)),(0,s.n)(this.doGraphiteRequest(t).pipe((0,l.U)((e=>(0,n.map)(e.data,(e=>({text:e.tag,id:e.id})))))))}getTagValues(e={}){const a={method:"GET",url:"/tags/"+this.templateSrv.replace(e.key),requestId:e.requestId};return e.range&&(a.params.from=this.translateTime(e.range.from,!1,e.timezone),a.params.until=this.translateTime(e.range.to,!0,e.timezone)),(0,s.n)(this.doGraphiteRequest(a).pipe((0,l.U)((e=>e.data&&e.data.values?(0,n.map)(e.data.values,(e=>({text:e.value,id:e.id}))):[]))))}getTagsAutoComplete(e,a,t){const r=t||{},i={method:"GET",url:"/tags/autoComplete/tags",params:{expr:(0,n.map)(e,(e=>this.templateSrv.replace((e||"").trim())))},requestId:r.requestId};return a&&(i.params.tagPrefix=a),r.limit&&(i.params.limit=r.limit),r.range&&(i.params.from=this.translateTime(r.range.from,!1,r.timezone),i.params.until=this.translateTime(r.range.to,!0,r.timezone)),(0,s.n)(this.doGraphiteRequest(i).pipe(O()))}getTagValuesAutoComplete(e,a,t,r){const i=r||{},o={method:"GET",url:"/tags/autoComplete/values",params:{expr:(0,n.map)(e,(e=>this.templateSrv.replace((e||"").trim()))),tag:this.templateSrv.replace((a||"").trim())},requestId:i.requestId};return t&&(o.params.valuePrefix=t),i.limit&&(o.params.limit=i.limit),i.range&&(o.params.from=this.translateTime(i.range.from,!1,i.timezone),o.params.until=this.translateTime(i.range.to,!0,i.timezone)),(0,s.n)(this.doGraphiteRequest(o).pipe(O()))}getVersion(e){const a={method:"GET",url:"/version",requestId:(e||{}).requestId};return(0,s.n)(this.doGraphiteRequest(a).pipe((0,l.U)((e=>{if(e.data){return new g(e.data).isValid()?e.data:""}return""})),(0,c.K)((()=>(0,r.of)("")))))}createFuncInstance(e,a){return S.createFuncInstance(e,a,this.funcDefs)}getFuncDef(e){return S.getFuncDef(e,this.funcDefs)}waitForFuncDefsLoaded(){return this.getFuncDefs()}getFuncDefs(){if(null!==this.funcDefsPromise)return this.funcDefsPromise;if(!h(this.graphiteVersion,"1.1"))return this.funcDefs=S.getFuncDefs(this.graphiteVersion),this.funcDefsPromise=Promise.resolve(this.funcDefs),this.funcDefsPromise;return(0,s.n)(this.doGraphiteRequest({method:"GET",url:"/functions"}).pipe((0,l.U)((e=>{if(200!==e.status||"object"!=typeof e.data)if("string"==typeof e.data){const a=JSON.parse(e.data.replace(/"default": ?Infinity/g,'"default": 1e9999'));this.funcDefs=S.parseFuncDefs(a)}else this.funcDefs=S.getFuncDefs(this.graphiteVersion);else this.funcDefs=S.parseFuncDefs(e.data);return this.funcDefs})),(0,c.K)((e=>(console.error("Fetching graphite functions error",e),this.funcDefs=S.getFuncDefs(this.graphiteVersion),(0,r.of)(this.funcDefs))))))}testDatasource(){return(0,s.n)(this.query({panelId:3,rangeRaw:{from:"now-1h",to:"now"},range:{raw:{from:"now-1h",to:"now"}},targets:[{target:"constantLine(100)"}],maxDataPoints:300})).then((()=>({status:"success",message:"Data source is working"})))}doGraphiteRequest(e){return(this.basicAuth||this.withCredentials)&&(e.withCredentials=!0),this.basicAuth&&(e.headers=e.headers||{},e.headers.Authorization=this.basicAuth),e.url=this.url+e.url,e.inspect={type:"graphite"},(0,m.getBackendSrv)().fetch(e).pipe((0,c.K)((e=>(0,i._)(function(e){var a,t;if(e&&500===e.status&&null!==(a=e.data)&&void 0!==a&&null!==(t=a.message)&&void 0!==t&&t.startsWith("<body")){const a=(0,n.last)(e.data.message.replace(/(<([^>]+)>)/gi,"").trim().split(/\n/)).replace(/u?&#[^;]+;/g,"");e.data.message=`Graphite encountered an unexpected error while handling your request. ${a}`}return e}(e)))))}buildGraphiteParams(e,a){const t=["from","until","rawData","format","maxDataPoints","cacheTimeout"],r=[],s={};let i,o,l;const c=/\#([A-Z])/g,m=/'(\d+)m'/gi;let u=!1;function d(e){return e.replace("m","min").replace("M","mon")}for(e.format="json",l=0;l<e.targets.length;l++)i=e.targets[l],i.target&&(i.refId||(i.refId=this._seriesRefLetters[l]),o=this.templateSrv.replace(i.target,a),o=o.replace(m,d),s[i.refId]=o);function p(e,a){return s[a]||e}for(l=0;l<e.targets.length;l++)i=e.targets[l],i.target&&(o=s[i.refId],o=o.replace(c,p),s[i.refId]=o,i.hide||(u=!0,r.push("target="+encodeURIComponent(o))));return(0,n.each)(e,((e,a)=>{-1!==(0,n.indexOf)(t,a)&&e&&r.push(a+"="+encodeURIComponent(e))})),u?r:[]}}function O(){return(0,o.z)((0,l.U)((e=>e.data?(0,n.map)(e.data,(e=>({text:e}))):[])))}var E,R,z,$,B,G,H,V=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),L=t("./packages/grafana-ui/src/index.ts"),W=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function U(e){return(0,W.jsxs)(L.Alert,{severity:"info",title:"How to map Graphite metrics to labels?",onRemove:e.onDismiss,children:[E||(E=(0,W.jsx)("p",{children:"Mappings are currently supported only between Graphite and Loki queries."})),R||(R=(0,W.jsx)("p",{children:"When you switch your data source from Graphite to Loki, your queries are mapped according to the mappings defined in the example below. To define a mapping, write the full path of the metric and replace nodes you want to map to label with the label name in parentheses. The value of the label is extracted from your Graphite query when you switch data sources."})),z||(z=(0,W.jsx)("p",{children:"All tags are automatically mapped to labels regardless of the mapping configuration. Graphite matching patterns (using {}) are converted to Loki's regular expressions matching patterns. When you use functions in your queries, the metrics, and tags are extracted to match them with defined mappings."})),$||($=(0,W.jsxs)("p",{children:["Example: for a mapping = ",(0,W.jsx)("code",{children:"servers.(cluster).(server).*"}),":"]})),B||(B=(0,W.jsxs)("table",{children:[(0,W.jsx)("thead",{children:(0,W.jsxs)("tr",{children:[(0,W.jsx)("th",{children:"Graphite query"}),(0,W.jsx)("th",{children:"Mapped to Loki query"})]})}),(0,W.jsxs)("tbody",{children:[(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:["alias(servers.",(0,W.jsx)("u",{children:"west"}),".",(0,W.jsx)("u",{children:"001"}),".cpu,1,2)"]})}),(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:['{cluster="',(0,W.jsx)("u",{children:"west"}),'", server="',(0,W.jsx)("u",{children:"001"}),'"}']})})]}),(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:["alias(servers.*.",(0,W.jsx)("u",{children:"{001,002}"}),".*,1,2)"]})}),(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:['{server=~"',(0,W.jsx)("u",{children:"(001|002)"}),'"}']})})]}),(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsx)("code",{children:"interpolate(seriesByTag('foo=bar', 'server=002'), inf))"})}),(0,W.jsx)("td",{children:(0,W.jsx)("code",{children:'{foo="bar", server="002"}'})})]})]})]}))]})}const Q=e=>{const[a,t]=(0,V.useState)(e.mappings||[]);return(0,W.jsxs)("div",{children:[G||(G=(0,W.jsx)("h3",{className:"page-heading",children:"Label mappings"})),!e.showHelp&&(0,W.jsx)("p",{children:(0,W.jsx)(L.Button,{variant:"link",onClick:e.onRestoreHelp,children:"Learn how label mappings work"})}),e.showHelp&&(0,W.jsx)(U,{onDismiss:e.onDismiss}),(0,W.jsxs)("div",{className:"gf-form-group",children:[a.map(((n,r)=>(0,W.jsxs)(L.InlineFieldRow,{children:[(0,W.jsx)(L.InlineField,{label:`Mapping (${r+1})`,children:(0,W.jsx)(L.Input,{width:50,onChange:e=>{let n=a.concat();n[r]=e.target.value,t(n)},onBlur:()=>{e.onChange(a)},placeholder:"e.g. test.metric.(labelName).*",value:n})}),(0,W.jsx)(L.Button,{type:"button","aria-label":"Remove header",variant:"secondary",size:"xs",onClick:n=>{let s=a.concat();s.splice(r,1),t(s),e.onChange(s)},children:H||(H=(0,W.jsx)(L.Icon,{name:"trash-alt"}))})]},r))),(0,W.jsx)(L.Button,{variant:"secondary",icon:"plus",type:"button",onClick:()=>{t([...a,""])},children:"Add label mapping"})]})]})};function Z(e){return{matchers:e.split(".").map((e=>e.startsWith("(")&&e.endsWith(")")?{value:"*",labelName:e.slice(1,-1)}:{value:e}))}}function J(e){return e.matchers.map((e=>e.labelName?`(${e.labelName})`:`${e.value}`)).join(".")}var K,X,Y,ee,ae=t("./public/app/core/store.ts");const{Select:te,Switch:ne}=L.LegacyForms,re="grafana.datasources.graphite.config.showMappingsHelp",se=I.map((e=>({label:`${e}.x`,value:e}))),ie=Object.entries(C).map((([e,a])=>({label:e,value:a})));class oe extends V.PureComponent{constructor(e){var a,t,n;super(e),n=()=>K||(K=(0,W.jsxs)("p",{children:["There are different types of Graphite compatible backends. Here you can specify the type you are using. If you are using"," ",(0,W.jsx)("a",{href:"https://github.com/grafana/metrictank",className:"pointer",target:"_blank",rel:"noreferrer",children:"Metrictank"})," ","then select that here. This will enable Metrictank specific features like query processing meta data. Metrictank is a multi-tenant timeseries engine for Graphite and friends."]})),(t="renderTypeHelp")in(a=this)?Object.defineProperty(a,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[t]=n,this.state={showMappingsHelp:ae.Z.getObject(re,!0)}}componentDidMount(){(0,u.updateDatasourcePluginJsonDataOption)(this.props,"graphiteVersion",this.currentGraphiteVersion)}render(){var e,a;const{options:t,onOptionsChange:n}=this.props,r=se.find((e=>e.value===this.currentGraphiteVersion));return(0,W.jsxs)(W.Fragment,{children:["direct"===t.access&&(X||(X=(0,W.jsx)(L.Alert,{title:"Deprecation Notice",severity:"warning",children:"This data source uses browser access mode. This mode is deprecated and will be removed in the future. Please use server access mode instead."}))),(0,W.jsx)(L.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:t,onChange:n}),Y||(Y=(0,W.jsx)("h3",{className:"page-heading",children:"Graphite details"})),(0,W.jsxs)("div",{className:"gf-form-group",children:[(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsxs)("div",{className:"gf-form",children:[ee||(ee=(0,W.jsx)(L.InlineFormLabel,{tooltip:"This option controls what functions are available in the Graphite query editor.",children:"Version"})),(0,W.jsx)(te,{"aria-label":"Graphite version",menuShouldPortal:!0,value:r,options:se,width:8,onChange:(0,u.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteVersion")})]})}),(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsxs)("div",{className:"gf-form",children:[(0,W.jsx)(L.InlineFormLabel,{tooltip:this.renderTypeHelp,children:"Type"}),(0,W.jsx)(te,{"aria-label":"Graphite backend type",menuShouldPortal:!0,options:ie,value:ie.find((e=>e.value===t.jsonData.graphiteType)),width:8,onChange:(0,u.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteType")})]})}),t.jsonData.graphiteType===C.Metrictank&&(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsx)("div",{className:"gf-form",children:(0,W.jsx)(ne,{label:"Rollup indicator",labelClass:"width-10",tooltip:"Shows up as an info icon in panel headers when data is aggregated",checked:!!t.jsonData.rollupIndicatorEnabled,onChange:(0,u.onUpdateDatasourceJsonDataOptionChecked)(this.props,"rollupIndicatorEnabled")})})})]}),(0,W.jsx)(Q,{mappings:((null===(e=t.jsonData.importConfiguration)||void 0===e||null===(a=e.loki)||void 0===a?void 0:a.mappings)||[]).map(J),showHelp:this.state.showMappingsHelp,onDismiss:()=>{this.setState({showMappingsHelp:!1}),ae.Z.setObject(re,!1)},onRestoreHelp:()=>{this.setState({showMappingsHelp:!0}),ae.Z.setObject(re,!0)},onChange:e=>{n(Object.assign({},t,{jsonData:Object.assign({},t.jsonData,{importConfiguration:Object.assign({},t.jsonData.importConfiguration,{loki:{mappings:e.map(Z)}})})}))}})]})}get currentGraphiteVersion(){return this.props.options.jsonData.graphiteVersion||N}}var le,ce,me,ue,de,pe=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),ge=t("./public/app/core/config.ts");class he extends V.PureComponent{renderMeta(e,a){var t;const n=fe(),r=D(e["schema-retentions"]),s=k([e]),i=M([e]),o=(null!==(t=e["consolidator-normfetch"])&&void 0!==t?t:"").replace("Consolidator",""),l=r.reduce(((e,a)=>e+(a.retention?u.rangeUtil.intervalToSeconds(a.retention):0)),0);return(0,W.jsxs)("div",{className:n.metaItem,children:[(0,W.jsxs)("div",{className:n.metaItemHeader,children:["Schema: ",e["schema-name"],(0,W.jsxs)("div",{className:"small muted",children:["Series count: ",e.count]})]}),(0,W.jsxs)("div",{className:n.metaItemBody,children:[(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 1: Fetch"}),(0,W.jsx)("div",{className:n.stepDescription,children:"First data is fetched, either from raw data archive or a rollup archive"}),s&&(0,W.jsx)("p",{children:s.text}),!s&&(le||(le=(0,W.jsx)("p",{children:"No rollup archive was used"}))),(0,W.jsx)("div",{children:r.map(((a,t)=>{const r=(a.retention?u.rangeUtil.intervalToSeconds(a.retention):0)/l*100,s=t===e["archive-read"];return(0,W.jsxs)("div",{className:n.bucket,children:[(0,W.jsx)("div",{className:n.bucketInterval,children:a.interval}),(0,W.jsx)("div",{className:(0,pe.cx)(n.bucketRetention,{[n.bucketRetentionActive]:s}),style:{flexGrow:r}}),(0,W.jsx)("div",{style:{flexGrow:100-r},children:a.retention})]},a.retention)}))})]}),(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 2: Normalization"}),(0,W.jsx)("div",{className:n.stepDescription,children:"Normalization happens when series with different intervals between points are combined."}),e["aggnum-norm"]>1&&(0,W.jsxs)("p",{children:["Normalization did occur using ",o]}),1===e["aggnum-norm"]&&(ce||(ce=(0,W.jsx)("p",{children:"No normalization was needed"})))]}),(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 3: Runtime consolidation"}),(0,W.jsx)("div",{className:n.stepDescription,children:"If there are too many data points at this point Metrictank will consolidate them down to below max data points (set in queries tab)."}),i&&(0,W.jsx)("p",{children:i.text}),!i&&(me||(me=(0,W.jsx)("p",{children:"No runtime consolidation"})))]})]})]},a)}render(){const{data:e}=this.props,a={};for(const t of e)if(t.meta&&t.meta.custom)for(const e of t.meta.custom.seriesMetaList){const t=`${JSON.stringify(e)}`;a[t]?a[t].count+=e.count:a[t]=e}return 0===Object.keys(a).length?ue||(ue=(0,W.jsx)("div",{children:"No response meta data"})):(0,W.jsxs)("div",{children:[de||(de=(0,W.jsx)("h2",{className:"page-heading",children:"Metrictank Lineage"})),Object.keys(a).map((e=>this.renderMeta(a[e],e)))]})}}const fe=(0,L.stylesFactory)((()=>{const{theme:e}=ge.vc,a=e.isDark?e.palette.gray25:e.palette.gray85,t=e.isDark?e.palette.dark1:e.palette.white,n=e.isDark?e.palette.gray15:e.palette.gray85;return{metaItem:pe.css`
      background: ${t};
      border: 1px solid ${a};
      margin-bottom: ${e.spacing.md};
    `,metaItemHeader:pe.css`
      background: ${n};
      padding: ${e.spacing.xs} ${e.spacing.md};
      font-size: ${e.typography.size.md};
      display: flex;
      justify-content: space-between;
    `,metaItemBody:pe.css`
      padding: ${e.spacing.md};
    `,stepHeading:pe.css`
      font-size: ${e.typography.size.md};
    `,stepDescription:pe.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.textWeak};
      margin-bottom: ${e.spacing.sm};
    `,step:pe.css`
      margin-bottom: ${e.spacing.lg};

      &:last-child {
        margin-bottom: 0;
      }
    `,bucket:pe.css`
      display: flex;
      margin-bottom: ${e.spacing.sm};
      border-radius: ${e.border.radius.md};
    `,bucketInterval:pe.css`
      flex-grow: 0;
      width: 60px;
    `,bucketRetention:pe.css`
      background: linear-gradient(0deg, ${e.palette.blue85}, ${e.palette.blue95});
      text-align: center;
      color: ${e.palette.white};
      margin-right: ${e.spacing.md};
      border-radius: ${e.border.radius.md};
    `,bucketRetentionActive:pe.css`
      background: linear-gradient(0deg, ${e.palette.greenBase}, ${e.palette.greenShade});
    `}}));var ye=t("./.yarn/__virtual__/@reduxjs-toolkit-virtual-5e60bdbc91/0/cache/@reduxjs-toolkit-npm-1.6.1-a0999c8262-487e340036.zip/node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js");const ve=(0,ye.PH)("init"),xe=(0,ye.PH)("time-range-changed"),be=(0,ye.PH)("queries-changed"),je=(0,ye.PH)("query-changed"),we=(0,ye.PH)("segment-value-changed"),Se=(0,ye.PH)("add-new-tag"),Pe={init:ve,timeRangeChanged:xe,queriesChanged:be,queryChanged:je,segmentValueChanged:we,tagChanged:(0,ye.PH)("tag-changed"),addNewTag:Se,unpause:(0,ye.PH)("unpause"),addFunction:(0,ye.PH)("add-function"),removeFunction:(0,ye.PH)("remove-function"),moveFunction:(0,ye.PH)("move-function"),updateFunctionParam:(0,ye.PH)("change-function-param"),updateQuery:(0,ye.PH)("update-query"),runQuery:(0,ye.PH)("run-current-query"),toggleEditorMode:(0,ye.PH)("toggle-editor")};var Ce=t("./public/app/plugins/datasource/graphite/graphite_query.ts"),Te=t("./public/app/store/store.ts"),qe=t("./public/app/core/reducers/appNotification.ts"),ke=t("./public/app/core/copy/appNotification.ts");const Me=["=","!=","=~","!=~"],De="tag: ";async function Fe(e){e.queryModel.parseTarget(),await Ie(e)}async function Ie(e,a=!0){e.segments=(0,n.clone)(e.queryModel.segments);const t=e.queryModel.checkOtherSegmentsIndex||0;await _e(e,t,a)}function Ne(e){e.queryModel.addSelectMetricSegment(),e.segments.push({value:"select metric",fake:!0})}async function _e(e,a,t=!0){if(1===e.queryModel.segments.length&&"series-ref"===e.queryModel.segments[0].type)return;if(0===a)return void Ne(e);const n=e.queryModel.getSegmentPathUpTo(a+1);if(""!==n)try{const r=await e.datasource.metricFindQuery(n);0===r.length?""!==n&&t&&(e.queryModel.segments=e.queryModel.segments.splice(0,a),e.segments=e.segments.splice(0,a),Ne(e)):r[0].expandable&&(e.segments.length===a?Ne(e):await _e(e,a+1))}catch(a){Ee(e,a)}}function Ae(e){e.queryModel.segments=[],e.segments=[]}function Oe(e){if(e.queryModel.error)return;const a=e.queryModel.target.target;e.queryModel.updateModelTarget((e.queries||[]).filter((e=>"target"in e&&"string"==typeof e.target))),e.queryModel.target.target===a||e.paused||e.refresh()}function Ee(e,a){return console.error(a),e.metricAutoCompleteErrorShown||(e.metricAutoCompleteErrorShown=!0,(0,Te.WI)((0,qe.$l)((0,ke.t_)(`Fetching metrics failed: ${a.message}.`)))),e}function Re(e,a){return console.error(a),e.tagsAutoCompleteErrorShown||(e.tagsAutoCompleteErrorShown=!0,(0,Te.WI)((0,qe.$l)((0,ke.t_)(`Fetching tags failed: ${a.message}.`)))),e}const ze=async(e,a)=>{if(a=Object.assign({},a),Pe.init.match(e)){const t=e.payload;t.target.target=t.target.target||"",await t.datasource.waitForFuncDefsLoaded(),a=Object.assign({},a,t,{queryModel:new Ce.Z(t.datasource,t.target,(0,m.getTemplateSrv)()),supportsTags:t.datasource.supportsTags,paused:!1,removeTagValue:"-- remove tag --",funcDefs:t.datasource.funcDefs,queries:t.queries}),await Ie(a,!1)}if(Pe.timeRangeChanged.match(e)&&(a.range=e.payload),Pe.queriesChanged.match(e)&&(a.queries=e.payload,Oe(a)),Pe.queryChanged.match(e)&&(a.target.target=e.payload.target||"",await Fe(a),Oe(a)),Pe.segmentValueChanged.match(e)){const{segment:t,index:n}=e.payload;let r;if(r="string"==typeof t?{value:t,expandable:!0,fake:!1}:t,a.error=null,a.segments[n]=r,a.queryModel.updateSegmentValue(r,n),a.queryModel.functions.length>0&&a.queryModel.functions[0].def.fake&&(a.queryModel.functions=[]),"tag"===r.type){const e=r.value.replace(De,"");return function(e){e.paused=!0}(a),await async function(e,a){const t=e.datasource.createFuncInstance("seriesByTag",{withDefaultParams:!1}),n=`${a}=`;t.params=[n],e.queryModel.addFunction(t),t.added=!0,Ae(e),Oe(e),await Fe(e)}(a,e),a}r.expandable?await _e(a,n+1):function(e,a){e.segments=e.segments.splice(0,a),e.queryModel.segments=e.queryModel.segments.splice(0,a)}(a,n+1),Oe(a)}if(Pe.tagChanged.match(e)){const{tag:t,index:n}=e.payload;a.queryModel.updateTag(t,n),Oe(a),0===a.queryModel.tags.length&&(await _e(a,0),a.paused=!1)}if(Pe.addNewTag.match(e)){const t={key:e.payload.segment.value,operator:"=",value:""};a.queryModel.addTag(t),Oe(a)}if(Pe.unpause.match(e)&&(a.paused=!1,a.refresh()),Pe.addFunction.match(e)){const t=a.datasource.createFuncInstance(e.payload.name,{withDefaultParams:!0});t.added=!0,a.queryModel.addFunction(t),function(e,a){if("aliasByNode"===a.def.name)for(let t=0;t<e.segments.length;t++)if(e.segments[t].value.indexOf("*")>=0)return a.params[0]=t,a.added=!1,void Oe(e)}(a,t),1===a.segments.length&&a.segments[0].fake&&Ae(a),!t.params.length&&t.added&&Oe(a),"seriesByTag"===t.def.name&&await Fe(a)}if(Pe.removeFunction.match(e)&&(a.queryModel.removeFunction(e.payload.func),Oe(a)),Pe.moveFunction.match(e)){const{func:t,offset:n}=e.payload;a.queryModel.moveFunction(t,n),Oe(a)}if(Pe.updateFunctionParam.match(e)){const{func:t,index:n,value:r}=e.payload;t.updateParam(r,n),Oe(a)}return Pe.updateQuery.match(e)&&(a.target.target=e.payload.query,Oe(a)),Pe.runQuery.match(e)&&a.refresh(),Pe.toggleEditorMode.match(e)&&(a.target.textEditor=!a.target.textEditor,await Fe(a)),Object.assign({},a)};var $e=t("./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js");const Be=(0,V.createContext)({}),Ge=(0,V.createContext)({}),He=()=>(0,V.useContext)(Be),Ve=({datasource:e,onRunQuery:a,onChange:t,query:n,queries:r,range:s,children:i})=>{const[o,l]=(0,V.useState)(),[c,m]=(0,V.useState)(!1),u=(0,V.useMemo)((()=>(e=>{let a={};return async t=>{a=await ze(t,a),e(a)}})((e=>{l(e)}))),[]),d=(0,$e.Z)(s);return(0,V.useEffect)((()=>{(null==d?void 0:d.raw)!==(null==s?void 0:s.raw)&&u(Pe.timeRangeChanged(s))}),[u,s,d]),(0,V.useEffect)((()=>{o&&u(Pe.queriesChanged(r))}),[u,r]),(0,V.useEffect)((()=>{var e;o&&(null===(e=o.target)||void 0===e?void 0:e.target)!==n.target&&u(Pe.queryChanged(n))}),[u,n]),(0,V.useEffect)((()=>{c&&o&&(m(!1),t(Object.assign({},n,{target:o.target.target})),a())}),[c,t,a,n]),o?(0,W.jsx)(Ge.Provider,{value:o,children:(0,W.jsx)(Be.Provider,{value:u,children:i})}):(u(Pe.init({target:n,datasource:e,range:s,templateSrv:(0,P.J)(),queries:r||[],refresh:()=>{m(!0)}})),null)};function Le({rawQuery:e}){const a=He(),t=(0,V.useCallback)((e=>{a(Pe.updateQuery({query:e}))}),[a]),n=(0,V.useCallback)((()=>{a(Pe.runQuery())}),[a]);return(0,W.jsx)(L.QueryField,{query:e,onChange:t,onBlur:n,onRunQuery:n,placeholder:"Enter a Graphite query (run with Shift+Enter)",portalOrigin:"graphite"})}function We(e){return e.map((e=>({value:e,label:e})))}function Ue(e){return e.map((e=>({label:e.value,value:e})))}function Qe(e,a,t){var n,r;return{name:e.name,value:(null==t?void 0:t.toString())||"",optional:!!e.optional||a,multiple:!!e.multiple,options:null!==(n=null===(r=e.options)||void 0===r?void 0:r.map((e=>({value:e.toString(),label:e.toString()}))))&&void 0!==n?n:[]}}const Ze=5e3;async function Je(e,a,t){let r=t.length>0?"*"+t+"*":"*";a>0&&(r=e.queryModel.getSegmentPathUpTo(a)+"."+r);const s={range:e.range,requestId:"get-alt-segments"};try{const i=await e.datasource.metricFindQuery(r,s),o=(0,n.map)(i,(e=>({value:e.text,expandable:e.expandable})));return a>0&&0===o.length?o:(0===a&&(0,n.eachRight)(e.queries,(a=>{a.refId!==e.queryModel.target.refId&&o.unshift({type:"series-ref",value:"#"+a.refId,expandable:!1})})),(0,n.eachRight)(e.templateSrv.getVariables(),(e=>{o.unshift({type:"template",value:"$"+e.name,expandable:!0})})),o.unshift({value:"*",expandable:!0}),o.splice(Ze),e.supportsTags&&0===a?(function(e){(0,n.remove)(e,(e=>"_tagged"===e.value))}(o),await async function(e,a,t){let r=await Xe(e,a);return r=(0,n.map)(r,(e=>(e.value=De+e.value,e))),t.concat(...r)}(e,t,o)):o)}catch(a){Ee(e,a)}return[]}async function Ke(e,a,t){return We(await async function(e,a,t){try{const r=e.queryModel.renderTagExpressions(a),s=await e.datasource.getTagsAutoComplete(r,t,{range:e.range,limit:Ze}),i=(0,n.map)(s,"text");return i.splice(0,0,e.removeTagValue),i}catch(a){Re(e,a)}return[]}(e,a,t))}async function Xe(e,a){let t;try{const r=e.queryModel.renderTagExpressions(),s=await e.datasource.getTagsAutoComplete(r,a,{range:e.range,limit:Ze});t=(0,n.map)(s,(e=>({value:e.text,type:"tag",expandable:!1})))}catch(a){t=[],Re(e,a)}return t}async function Ye(e,a,t,r){return We(await async function(e,a,t,r){const s=e.queryModel.renderTagExpressions(t),i=a.key,o=await e.datasource.getTagValuesAutoComplete(s,i,r,{limit:Ze}),l=(0,n.map)(o,"text");return(0,n.eachRight)(e.templateSrv.getVariables(),(e=>{l.push("${"+e.name+":regex}")})),l}(e,a,t,r))}function ea({tag:e,tagIndex:a,state:t}){const r=He(),s=(0,V.useCallback)((e=>Ke(t,a,e||"")),[t,a]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]),o=(0,V.useCallback)((n=>Ye(t,e,a,n||"")),[t,a,e]),l=(0,V.useMemo)((()=>(0,n.debounce)(o,200,{leading:!0})),[o]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,value:e.key,loadOptions:i,reloadOptionsOnChange:!0,onChange:t=>{r(Pe.tagChanged({tag:Object.assign({},e,{key:t.value}),index:a}))},allowCustomValue:!0}),(0,W.jsx)(L.Segment,{inputMinWidth:50,value:e.operator,options:We(Me),onChange:t=>{r(Pe.tagChanged({tag:Object.assign({},e,{operator:t.value}),index:a}))}}),(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,value:e.value,loadOptions:l,reloadOptionsOnChange:!0,onChange:t=>{r(Pe.tagChanged({tag:Object.assign({},e,{value:t.value}),index:a}))},allowCustomValue:!0})]})}function aa(){const e=He(),a=(0,V.useCallback)((()=>{e(Pe.unpause())}),[e]);return(0,W.jsx)(L.Button,{icon:"play",onClick:a,type:"button",variant:"secondary","aria-label":"Unpause query"})}var ta;function na({tags:e,state:a}){const t=He(),r=(0,L.useStyles2)(ra),s=(0,V.useCallback)((e=>async function(e,a){return Ue(await Xe(e,a))}(a,e||"")),[a]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]);return(0,W.jsxs)(W.Fragment,{children:[e.map(((e,t)=>(0,W.jsx)(ea,{tagIndex:t,tag:e,state:a},t))),e.length&&(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,onChange:e=>{t(Pe.addNewTag({segment:e.value}))},loadOptions:i,reloadOptionsOnChange:!0,Component:(0,W.jsx)(L.Button,{icon:"plus",variant:"secondary",className:r.button,"aria-label":"Add new tag"})}),a.paused&&(ta||(ta=(0,W.jsx)(aa,{})))]})}function ra(e){return{button:pe.css`
      margin-right: ${e.spacing(.5)};
    `}}function sa({metricIndex:e,segment:a,state:t}){const r=He(),s=(0,V.useCallback)((a=>async function(e,a,t){return Ue(await Je(e,a,t))}(t,e,a||"")),[t,e]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]),o=(0,V.useCallback)((a=>{r(Pe.segmentValueChanged({segment:a.value,index:e}))}),[r,e]),l=(0,V.useMemo)((()=>(0,n.debounce)(o,100)),[o]);return(0,W.jsx)(L.SegmentAsync,{value:a.value,inputMinWidth:150,allowCustomValue:!0,loadOptions:i,reloadOptionsOnChange:!0,onChange:l})}function ia({segments:e=[],state:a}){return(0,W.jsx)(W.Fragment,{children:e.map(((e,t)=>(0,W.jsx)(sa,{segment:e,metricIndex:t,state:a},t)))})}function oa({state:e}){var a,t;const n=null!==(a=e.queryModel)&&void 0!==a&&a.seriesByTagUsed?(0,W.jsx)(na,{tags:null===(t=e.queryModel)||void 0===t?void 0:t.tags,state:e}):(0,W.jsx)(ia,{segments:e.segments,state:e});return(0,W.jsx)(L.SegmentSection,{label:"Series",fill:!0,children:n})}function la({editableParam:e,onChange:a,onExpandedChange:t,autofocus:n}){var r;const s=(0,L.useStyles2)(ca);return(null===(r=e.options)||void 0===r?void 0:r.length)>0?(0,W.jsx)(L.Segment,{autofocus:n,value:e.value,inputPlaceholder:e.name,className:s.segment,options:e.options,placeholder:" +"+e.name,onChange:e=>{a(e.value||"")},onExpandedChange:t,inputMinWidth:150,allowCustomValue:!0,allowEmptyValue:!0}):(0,W.jsx)(L.SegmentInput,{autofocus:n,className:s.input,value:e.value||"",placeholder:" +"+e.name,inputPlaceholder:e.name,onChange:e=>{a(e.toString())},onExpandedChange:t,style:{height:"25px",paddingTop:"2px",marginTop:"2px",paddingLeft:"4px",minWidth:"100px"}})}const ca=e=>({segment:(0,pe.css)({margin:0,padding:0}),input:pe.css`
    margin: 0;
    padding: 0;
    input {
      height: 25px;
    },
  `});var ma;const ua=V.lazy((async()=>{const{default:e}=await t.e(495).then(t.t.bind(t,"./.yarn/cache/rst2html-https-e87da7ea2f-63d5ff3068.zip/node_modules/rst2html/dist/rst2html.min.js",23));return{default(a){var t;return(0,W.jsx)("div",{dangerouslySetInnerHTML:{__html:e(null!==(t=a.description)&&void 0!==t?t:"")}})}}})),da=e=>{if(e.description){let a=(0,W.jsx)(V.Suspense,{fallback:ma||(ma=(0,W.jsx)("span",{children:"Loading description..."})),children:(0,W.jsx)(ua,{description:e.description})});return(0,W.jsx)(L.Tooltip,{content:a,placement:"bottom-end",children:(0,W.jsx)(L.Icon,{className:e.description?void 0:"pointer",name:"question-circle"})})}return(0,W.jsx)(L.Icon,{className:"pointer",name:"question-circle",onClick:()=>{window.open("http://graphite.readthedocs.org/en/latest/functions.html#graphite.render.functions."+e.name,"_blank")}})},pa=e=>{const{func:a,onMoveLeft:t,onMoveRight:n,onRemove:r}=e;return(0,W.jsxs)("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"},children:[(0,W.jsx)(L.Icon,{name:"arrow-left",onClick:()=>t(a)}),(0,W.jsx)(da,{name:a.def.name,description:a.def.description}),(0,W.jsx)(L.Icon,{name:"times",onClick:()=>r(a)}),(0,W.jsx)(L.Icon,{name:"arrow-right",onClick:()=>n(a)})]})};var ga,ha;const fa=["onMoveLeft","onMoveRight","func"];const ya=e=>({icon:pe.css`
      margin-right: ${e.spacing(.5)};
    `,label:(0,pe.css)({fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.bodySmall.fontSize,cursor:"pointer",display:"inline-block",paddingBottom:"2px"})}),va=e=>{let{onMoveLeft:a,onMoveRight:t,func:n}=e,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,fa);const s=(0,V.useRef)(null),i=(0,L.useStyles2)(ya);return(0,W.jsx)(L.PopoverController,{content:({updatePopperPosition:e})=>(0,W.jsx)(pa,Object.assign({},r,{func:n,onMoveLeft:()=>{a(n),e()},onMoveRight:()=>{t(n),e()}})),placement:"top",hideAfter:100,children:(e,a,t)=>(0,W.jsxs)(W.Fragment,{children:[s.current&&(0,W.jsx)(L.Popover,Object.assign({},t,{referenceElement:s.current,wrapperClassName:"popper",className:"popper__background",renderArrow:({arrowProps:e,placement:a})=>(0,W.jsx)("div",Object.assign({className:"popper__arrow","data-placement":a},e))})),(0,W.jsx)(L.ClickOutsideWrapper,{onClick:()=>{t.show&&a()},children:(0,W.jsxs)("span",{ref:s,onClick:t.show?a:e,className:i.label,children:[n.def.unknown&&(0,W.jsx)(L.Tooltip,{content:ga||(ga=(0,W.jsx)(xa,{})),placement:"bottom",children:(0,W.jsx)(L.Icon,{"data-testid":"warning-icon",name:"exclamation-triangle",size:"xs",className:i.icon})}),n.def.name]})})]})})},xa=V.memo((()=>ha||(ha=(0,W.jsxs)("span",{children:["This function is not supported. Check your function for typos and"," ",(0,W.jsx)("a",{target:"_blank",className:"external-link",rel:"noreferrer noopener",href:"https://graphite.readthedocs.io/en/latest/functions.html",children:"read the docs"})," ","to see whether you need to upgrade your data sources version to make this function available."]}))));function ba({func:e}){const a=He(),t=(0,L.useStyles2)(ja),[n,r]=(0,V.useState)(!1),[s,i]=(0,V.useState)(!1);let o=function(e){var a;const t=e.def.params.map(((a,t)=>Qe(a,!1,e.params[t])));for(;t.length<e.params.length;){const a=e.def.params[e.def.params.length-1],n=e.params[t.length];t.push(Qe(a,!0,n))}if(t.length&&t[t.length-1].value&&null!==(a=t[t.length-1])&&void 0!==a&&a.multiple){const a=e.def.params[e.def.params.length-1];t.push(Qe(a,!0,""))}return t}(e);return o=o.filter(((a,t)=>t<e.def.params.length&&!a.optional||e.added||a.value||s||n)),(0,W.jsx)("div",{className:(0,pe.cx)(t.container,{[t.error]:e.def.unknown}),onMouseOver:()=>r(!0),onMouseLeave:()=>r(!1),children:(0,W.jsxs)(L.HorizontalGroup,{spacing:"none",children:[(0,W.jsx)(va,{func:e,onMoveLeft:()=>{a(Pe.moveFunction({func:e,offset:-1}))},onMoveRight:()=>{a(Pe.moveFunction({func:e,offset:1}))},onRemove:()=>{a(Pe.removeFunction({func:e}))}}),(0,W.jsx)(L.InlineLabel,{className:t.label,children:"("}),o.map(((t,n)=>(0,W.jsxs)(V.Fragment,{children:[(0,W.jsx)(la,{autofocus:0===n&&e.added,editableParam:t,onChange:s=>{(""!==s||t.optional)&&a(Pe.updateFunctionParam({func:e,index:n,value:s})),i(!1),r(!1)},onExpandedChange:i}),n!==o.length-1?",":""]},n))),(0,W.jsx)(L.InlineLabel,{className:t.label,children:")"})]})})}xa.displayName="FunctionEditorTooltipContent";const ja=e=>({container:(0,pe.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`}),error:pe.css`
    border: 1px solid ${e.colors.error.main};
  `,label:(0,pe.css)({padding:0,margin:0}),button:(0,pe.css)({padding:e.spacing(.5)})});function wa({funcDefs:e}){const a=He(),[t,r]=(0,V.useState)(void 0),s=(0,L.useStyles2)(Sa),i=(0,V.useMemo)((()=>function(e){const a={};return(0,n.forEach)(e,(e=>{e.category&&(a[e.category]||(a[e.category]={label:e.category,value:e.category,options:[]}),a[e.category].options.push({label:e.name,value:e.name}))})),(0,n.sortBy)(a,"label")}(e)),[e]);return(0,V.useEffect)((()=>{void 0!==(null==t?void 0:t.value)&&(a(Pe.addFunction({name:t.value})),r(void 0))}),[t,a]),(0,W.jsx)(L.Segment,{Component:(0,W.jsx)(L.Button,{icon:"plus",variant:"secondary",className:(0,pe.cx)(s.button),"aria-label":"Add new function"}),options:i,onChange:r,inputMinWidth:150})}function Sa(e){return{button:pe.css`
      margin-right: ${e.spacing(.5)};
    `}}function Pa({functions:e=[],funcDefs:a}){return(0,W.jsxs)(L.SegmentSection,{label:"Functions",fill:!0,children:[e.map(((e,a)=>!e.hidden&&(0,W.jsx)(ba,{func:e},a))),(0,W.jsx)(wa,{funcDefs:a})]})}var Ca,Ta,qa,ka;function Ma(){var e,a,t;const n=He(),r=(0,V.useContext)(Ge),s=(0,L.useStyles2)(Da);return(0,W.jsxs)("div",{className:s.container,children:[(0,W.jsxs)("div",{className:s.visualEditor,children:[(null===(e=r.target)||void 0===e?void 0:e.textEditor)&&(0,W.jsx)(Le,{rawQuery:r.target.target}),!(null!==(a=r.target)&&void 0!==a&&a.textEditor)&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(oa,{state:r}),(0,W.jsx)(Pa,{functions:null===(t=r.queryModel)||void 0===t?void 0:t.functions,funcDefs:r.funcDefs})]})]}),(0,W.jsx)(L.Button,{className:s.toggleButton,icon:"pen",variant:"secondary","aria-label":"Toggle editor mode",onClick:()=>{n(Pe.toggleEditorMode())}})]})}function Da(e){return{container:pe.css`
      display: flex;
    `,visualEditor:pe.css`
      flex-grow: 1;
    `,toggleButton:pe.css`
      margin-left: ${e.spacing(.5)};
    `}}class Fa{}ka="partials/annotations.editor.html",(qa="templateUrl")in(Ta=Fa)?Object.defineProperty(Ta,qa,{value:ka,enumerable:!0,configurable:!0,writable:!0}):Ta[qa]=ka;const Ia=new u.DataSourcePlugin(A).setQueryEditor((function({datasource:e,onRunQuery:a,onChange:t,query:n,range:r,queries:s}){return(0,W.jsx)(Ve,{datasource:e,onRunQuery:a,onChange:t,query:n,queries:s,range:r,children:Ca||(Ca=(0,W.jsx)(Ma,{}))})})).setConfigEditor(oe).setMetadataInspector(he).setAnnotationQueryCtrl(Fa)},"./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js":(e,a,t)=>{t.d(a,{Z:()=>r});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");function r(e){var a=(0,n.useRef)();return(0,n.useEffect)((function(){a.current=e})),a.current}}}]);
//# sourceMappingURL=graphitePlugin.787ecc600122eb73aeab.js.map